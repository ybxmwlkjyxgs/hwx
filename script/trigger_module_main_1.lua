local ____lualib = base.tsc
local __TS__TypeReference = ____lualib.__TS__TypeReference
local __TS__Class = ____lualib.__TS__Class
local __TS__ClassExtends = ____lualib.__TS__ClassExtends
local __TS__SuperTypeArgumentsFuncWrapper = ____lualib.__TS__SuperTypeArgumentsFuncWrapper
local __TS__New = ____lualib.__TS__New
local __TS__Class2 = ____lualib.__TS__Class2
Cast = base.tsc.CLASSES.Cast or __TS__Class2("Cast")
RegionCircle = base.tsc.CLASSES.RegionCircle or __TS__Class2("RegionCircle")
RegionRect = base.tsc.CLASSES.RegionRect or __TS__Class2("RegionRect")
Vector = base.tsc.CLASSES.Vector or __TS__Class2("Vector")
ScoreCropData = base.tsc.CLASSES.ScoreCropData or __TS__Class2("ScoreCropData")
crop = base.tsc.CLASSES.crop or __TS__Class2("crop")
QuestCondition = base.tsc.CLASSES.QuestCondition or __TS__Class2("QuestCondition")
Quest = base.tsc.CLASSES.Quest or __TS__Class2("Quest")
SceneObject = base.tsc.CLASSES.SceneObject or __TS__Class2("SceneObject")
UnitPropertyBonus = base.tsc.CLASSES.UnitPropertyBonus or __TS__Class2("UnitPropertyBonus")
ScoreRankAddParam = base.tsc.CLASSES.ScoreRankAddParam or __TS__Class2("ScoreRankAddParam")
ScoreRankSetParam = base.tsc.CLASSES.ScoreRankSetParam or __TS__Class2("ScoreRankSetParam")
autotest_log = base.tsc.CLASSES.autotest_log or __TS__Class2("autotest_log")
UnitBuff = base.tsc.CLASSES.UnitBuff or __TS__Class2("UnitBuff")
DateTime = base.tsc.CLASSES.DateTime or __TS__Class2("DateTime")
os = base.tsc.CLASSES.os or __TS__Class2("os")
ScoreMoneyParam = base.tsc.CLASSES.ScoreMoneyParam or __TS__Class2("ScoreMoneyParam")
ScoreMsgID = base.tsc.CLASSES.ScoreMsgID or __TS__Class2("ScoreMsgID")
ScoreNameData = base.tsc.CLASSES.ScoreNameData or __TS__Class2("ScoreNameData")
ScoreID = base.tsc.CLASSES.ScoreID or __TS__Class2("ScoreID")
ScoreListID = base.tsc.CLASSES.ScoreListID or __TS__Class2("ScoreListID")
ScoreMsgData = base.tsc.CLASSES.ScoreMsgData or __TS__Class2("ScoreMsgData")
ScoreGetRankTotalParam = base.tsc.CLASSES.ScoreGetRankTotalParam or __TS__Class2("ScoreGetRankTotalParam")
ScoreGetRankTotalData = base.tsc.CLASSES.ScoreGetRankTotalData or __TS__Class2("ScoreGetRankTotalData")
ScoreGetUserRankData = base.tsc.CLASSES.ScoreGetUserRankData or __TS__Class2("ScoreGetUserRankData")
ScoreGetRankListData = base.tsc.CLASSES.ScoreGetRankListData or __TS__Class2("ScoreGetRankListData")
ScoreGetUserRankParam = base.tsc.CLASSES.ScoreGetUserRankParam or __TS__Class2("ScoreGetUserRankParam")
ScoreGetRankListParam = base.tsc.CLASSES.ScoreGetRankListParam or __TS__Class2("ScoreGetRankListParam")
ScoreChannelMsgData = base.tsc.CLASSES.ScoreChannelMsgData or __TS__Class2("ScoreChannelMsgData")
ScoreNameSearchParam = base.tsc.CLASSES.ScoreNameSearchParam or __TS__Class2("ScoreNameSearchParam")
ScoreNameNewParam = base.tsc.CLASSES.ScoreNameNewParam or __TS__Class2("ScoreNameNewParam")
ScoreMsgQueryParam = base.tsc.CLASSES.ScoreMsgQueryParam or __TS__Class2("ScoreMsgQueryParam")
ScoreMsgSendParam = base.tsc.CLASSES.ScoreMsgSendParam or __TS__Class2("ScoreMsgSendParam")
ScoreListData = base.tsc.CLASSES.ScoreListData or __TS__Class2("ScoreListData")
ScoreListDeleteParam = base.tsc.CLASSES.ScoreListDeleteParam or __TS__Class2("ScoreListDeleteParam")
ScoreListModifyParam = base.tsc.CLASSES.ScoreListModifyParam or __TS__Class2("ScoreListModifyParam")
ScoreListAddParam = base.tsc.CLASSES.ScoreListAddParam or __TS__Class2("ScoreListAddParam")
ScoreMoneyData = base.tsc.CLASSES.ScoreMoneyData or __TS__Class2("ScoreMoneyData")
ScoreAddParam = base.tsc.CLASSES.ScoreAddParam or __TS__Class2("ScoreAddParam")
ScoreSetParam = base.tsc.CLASSES.ScoreSetParam or __TS__Class2("ScoreSetParam")
ScoreData = base.tsc.CLASSES.ScoreData or __TS__Class2("ScoreData")
UserID = base.tsc.CLASSES.UserID or __TS__Class2("UserID")
ScoreGetParam = base.tsc.CLASSES.ScoreGetParam or __TS__Class2("ScoreGetParam")
ScoreObjData = base.tsc.CLASSES.ScoreObjData or __TS__Class2("ScoreObjData")
ScoreCommitter = base.tsc.CLASSES.ScoreCommitter or __TS__Class2("ScoreCommitter")
AISearcher = base.tsc.CLASSES.AISearcher or __TS__Class2("AISearcher")
DataCache = base.tsc.CLASSES.DataCache or __TS__Class2("DataCache")
Sight = base.tsc.CLASSES.Sight or __TS__Class2("Sight")
UnitGroup = base.tsc.CLASSES.UnitGroup or __TS__Class2("UnitGroup")
Line = base.tsc.CLASSES.Line or __TS__Class2("Line")
Trigger = base.tsc.CLASSES.Trigger or __TS__Class2("Trigger")
Player = base.tsc.CLASSES.Player or __TS__Class2("Player")
Inventory = base.tsc.CLASSES.Inventory or __TS__Class2("Inventory")
Skill = base.tsc.CLASSES.Skill or __TS__Class2("Skill")
Slot = base.tsc.CLASSES.Slot or __TS__Class2("Slot")
DamageInstance = base.tsc.CLASSES.DamageInstance or __TS__Class2("DamageInstance")
TriggerEvent = base.tsc.CLASSES.TriggerEvent or __TS__Class2("TriggerEvent")
HealInstance = base.tsc.CLASSES.HealInstance or __TS__Class2("HealInstance")
Buff = base.tsc.CLASSES.Buff or __TS__Class2("Buff")
Unit = base.tsc.CLASSES.Unit or __TS__Class2("Unit")
Mover = base.tsc.CLASSES.Mover or __TS__Class2("Mover")
Point = base.tsc.CLASSES.Point or __TS__Class2("Point")
EffectParam = base.tsc.CLASSES.EffectParam or __TS__Class2("EffectParam")
UnitTable = base.tsc.CLASSES.UnitTable or __TS__Class2("UnitTable")
Target = base.tsc.CLASSES.Target or __TS__Class2("Target")
ScreenPos = base.tsc.CLASSES.ScreenPos or __TS__Class2("ScreenPos")
Region = base.tsc.CLASSES.Region or __TS__Class2("Region")
Item = base.tsc.CLASSES.Item or __TS__Class2("Item")
TriggerParamTable = base.tsc.CLASSES.TriggerParamTable or __TS__Class2("TriggerParamTable")
EffectParamShared = base.tsc.CLASSES.EffectParamShared or __TS__Class2("EffectParamShared")
Snapshot = base.tsc.CLASSES.Snapshot or __TS__Class2("Snapshot")
Timer = base.tsc.CLASSES.Timer or __TS__Class2("Timer")
Team = base.tsc.CLASSES.Team or __TS__Class2("Team")
Actor = base.tsc.CLASSES.Actor or __TS__Class2("Actor")
Coroutine = base.tsc.CLASSES.Coroutine or __TS__Class2("Coroutine")
IEventNotify = base.tsc.CLASSES.IEventNotify or __TS__Class2("IEventNotify")
Present = base.tsc.CLASSES.Present or __TS__Class2("Present")
Array = base.tsc.CLASSES.Array or __TS__Class2("Array")
hwx_6151 = hwx_6151 or ({})
do
    hwx_6151.主玩家 = base.player(1)
    hwx_6151.敌人玩家 = base.player(2)
    hwx_6151.单个刷怪 = function(____, 刷怪表)
        base.timer_wait(
            刷怪表.delay,
            function()
                base.timer_timer(
                    刷怪表.pulse,
                    刷怪表.times,
                    function()
                        local 怪物Id = 刷怪表.monster
                        local 创建角度 = 0
                        local 创建位置 = hwx_6151.主玩家:get_hero():get_scene_point()
                        do
                            local index = 0
                            while index <= 刷怪表.num do
                                创建角度 = base.math.random_float(0, 360)
                                创建位置 = hwx_6151.主玩家:get_hero():get_scene_point():polar_to_ex(创建角度, hwx_6151.刷怪范围)
                                创建位置 = base.scene_point(
                                    base.math.max(
                                        base.math.min(
                                            创建位置:get_x(),
                                            hwx_6151.地图坐标最大值
                                        ),
                                        hwx_6151.地图坐标最小值
                                    ),
                                    base.math.max(
                                        base.math.min(
                                            创建位置:get_y(),
                                            hwx_6151.地图坐标最大值
                                        ),
                                        hwx_6151.地图坐标最小值
                                    ),
                                    nil,
                                    "default"
                                )
                                base.player_create_unit_ai(
                                    hwx_6151.敌人玩家,
                                    怪物Id,
                                    创建位置,
                                    0,
                                    true
                                )
                                index = index + 1
                            end
                        end
                    end
                )
            end
        )
    end
    hwx_6151.单波刷怪 = function(____, 波次表)
        local 波次准备时间 = 波次表.wave_delay
        local 波次持续时间 = 波次表.wave_time
        local 刷怪Id数组 = 波次表.wave_data
        if 波次持续时间 == -1 then
            波次持续时间 = 0
            if 刷怪Id数组 ~= nil then
                for 遍历到的数组索引, 遍历到的数组元素 in base.ArrayIterator(刷怪Id数组) do
                    local 刷怪表 = base.eff.cache_ts(
                        __TS__TypeReference(_OBJ__spawner_Spawner, {}),
                        遍历到的数组元素
                    )
                    波次持续时间 = base.math.max(刷怪表.delay + 刷怪表.times * 刷怪表.pulse, 波次持续时间)
                end
            else
                log.warn("不能遍历：刷怪Id数组")
            end
        else
        end
        base.timer_sleep(波次准备时间)
        log.debug("刷怪", 波次表.Name, 波次持续时间)
        if 刷怪Id数组 ~= nil then
            for 遍历到的数组索引, 遍历到的数组元素 in base.ArrayIterator(刷怪Id数组) do
                local 刷怪表 = base.eff.cache_ts(
                    __TS__TypeReference(_OBJ__spawner_Spawner, {}),
                    遍历到的数组元素
                )
                hwx_6151:单个刷怪(刷怪表)
            end
        else
            log.warn("不能遍历：刷怪Id数组")
        end
        base.timer_sleep(波次持续时间)
    end
    local function _TRIG_关卡刷怪_FUNC(当前触发器, e)
        local 关卡配置表 = base.force_as(
            __TS__TypeReference(_OBJ__level_Level, {}),
            base.eff.cache(hwx_6151.关卡配置表Id)
        )
        if true then
            base.timer_sleep(5)
            if 关卡配置表.waves ~= nil then
                for 遍历到的数组索引, 遍历到的数组元素 in base.ArrayIterator(关卡配置表.waves) do
                    local 波次表 = base.force_as(
                        __TS__TypeReference(_OBJ__wave_Wave, {}),
                        base.eff.cache(遍历到的数组元素)
                    )
                    hwx_6151:单波刷怪(波次表)
                end
            else
                log.warn("不能遍历：关卡配置表.waves")
            end
            log.info("刷怪结束！30秒后结束游戏")
            base.timer_sleep(30)
            base.pause_game()
            hwx_6151:游戏胜利()
        end
    end
    hwx_6151.关卡刷怪 = base.trigger_new(
        _TRIG_关卡刷怪_FUNC,
        {},
        false,
        nil,
        true
    )
    hwx_6151.刷怪范围 = 1500
    hwx_6151.地图坐标最小值 = 200
    hwx_6151.地图坐标最大值 = 16184
    hwx_6151.关卡配置表Id = "$$hwx_6151.level.吸血鬼默认关卡.root"
    local function _TRIG_游戏开始时弹出初始选择_FUNC(当前触发器, e)
        if e.is_reconnect == false then
            base.pause_game()
            smallcard_choose_one.open_n_pick_1(
                hwx_6151.主玩家:get_hero(),
                3,
                hwx_6151.英雄初始技能奖励表Id
            )
        end
    end
    hwx_6151.游戏开始时弹出初始选择 = base.trigger_new(
        _TRIG_游戏开始时弹出初始选择_FUNC,
        {},
        false,
        nil,
        true
    )
    local function _TRIG_升级时弹出选择_FUNC(当前触发器, e)
        if e.unit == hwx_6151.主玩家:get_hero() then
            log.debug("主控升级，弹出选择")
            base.pause_game()
            smallcard_choose_one.open_n_pick_1(
                hwx_6151.主玩家:get_hero(),
                3,
                hwx_6151.英雄技能奖励表Id
            )
        end
    end
    hwx_6151.升级时弹出选择 = base.trigger_new(
        _TRIG_升级时弹出选择_FUNC,
        {},
        false,
        nil,
        true
    )
    local function _TRIG_选择后继续游戏_FUNC(当前触发器, e)
        local 玩家 = e.player
        if 玩家 == hwx_6151.主玩家 then
            base.unpause_game()
        end
    end
    hwx_6151.选择后继续游戏 = base.trigger_new(
        _TRIG_选择后继续游戏_FUNC,
        {},
        false,
        nil,
        true
    )
    hwx_6151.英雄初始技能奖励表Id = "$$hwx_6151.loot_pool.英雄初始技能奖励池.root"
    hwx_6151.英雄技能奖励表Id = "$$hwx_6151.loot_pool.英雄技能奖励池.root"
    hwx_6151.游戏结束事件 = __TS__Class()
    local 游戏结束事件 = hwx_6151.游戏结束事件
    游戏结束事件.name = "游戏结束事件"
    __TS__ClassExtends(
        游戏结束事件,
        TriggerEvent,
        function()
            return {}
        end
    )
    function 游戏结束事件.prototype.____constructor(self, obj, is_win)
        __TS__SuperTypeArgumentsFuncWrapper(游戏结束事件, {}, TriggerEvent.prototype.____constructor)(self)
        self.obj = obj
        self.is_win = is_win
        self.event_name = "游戏结束事件"
        self.autoForward = true
    end
    hwx_6151.游戏失败 = function()
        base.send_custom_event(__TS__New(hwx_6151.游戏结束事件, {}, base.game, false))
    end
    hwx_6151.游戏胜利 = function()
        base.send_custom_event(__TS__New(hwx_6151.游戏结束事件, {}, base.game, true))
    end
    local function _TRIG_死亡后暂停游戏_FUNC(当前触发器, e)
        if e.unit == hwx_6151.主玩家:get_hero() then
            base.timer_sleep(5)
            hwx_6151:游戏失败()
            base.timer_sleep(2)
            base.pause_game()
        end
    end
    hwx_6151.死亡后暂停游戏 = base.trigger_new(
        _TRIG_死亡后暂停游戏_FUNC,
        {},
        false,
        nil,
        true
    )
    hwx_6151.关卡刷怪:add_event_common({obj = hwx_6151.主玩家, event_name = "玩家-连入"})
    hwx_6151.游戏开始时弹出初始选择:add_event_common({obj = hwx_6151.主玩家, event_name = "玩家-连入"})
    hwx_6151.升级时弹出选择:add_event_common({obj = base.any_unit, event_name = "单位-升级"})
    hwx_6151.选择后继续游戏:add_event_common({obj = base.game, event_name = "玩家-点击关闭n选1"})
    hwx_6151.死亡后暂停游戏:add_event_common({obj = base.any_unit, event_name = "单位-死亡"})
end
